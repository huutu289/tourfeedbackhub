/**
 * @fileoverview Firestore Security Rules for the Tour Insights Hub application.
 *
 * Core Philosophy:
 * Public read access for all collections.
 * Write access is open for development - should be restricted in production.
 *
 * NOTE: App Check enforcement is handled at the Firebase Console level,
 * NOT in security rules. To enable App Check:
 * 1. Go to Firebase Console â†’ App Check
 * 2. Find "Cloud Firestore" and click "Enforce"
 * 3. All requests without valid App Check tokens will be rejected
 *
 * Data Structure:
 * - /site_settings: Stores global site settings.
 * - /tour_types: Stores tour types.
 * - /tours: Stores tour information.
 * - /feedback: Stores user feedback.
 */
rules_version = '2';
service cloud.firestore {
  function isAdmin() {
    return request.auth != null && request.auth.token.admin == true;
  }

  function isAllowlisted() {
    return request.auth != null &&
      request.auth.token.email in [
        "huutu289@gmail.com",
        "iposntmk@gmail.com"
      ];
  }

  function canWriteAdmin() {
    return isAdmin() || isAllowlisted();
  }

  match /databases/{database}/documents {

    match /navigationMenus/{menuId} {
      allow read: if true;
      allow write: if canWriteAdmin();

      match /items/{itemId} {
        allow read: if true;
        allow write: if canWriteAdmin();
      }
    }

    match /siteSettings/{siteSettingsId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /tourTypes/{tourTypeId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /tours/{tourId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /feedback/{feedbackId} {
      allow read, write: if true;
    }

    match /stories/{storyId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /reviews/{reviewId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /guides/{guideId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /languages/{languageId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /provinces/{provinceId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /nationalities/{nationalityId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }

    match /siteContentSlides/{slideId} {
      allow read: if true;
      allow write: if canWriteAdmin();
    }
  }
}
