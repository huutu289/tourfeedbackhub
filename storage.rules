rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // --- Publicly readable content ---
    // Media for reviews and public assets
    match /public/{allPaths=**} {
      allow read;
    }

    // Media for tours should be publicly readable
    match /tours/{tourId}/{allPaths=**} {
      allow read;
      // Allow writes only by authenticated admin users
      allow write: if request.auth != null && request.auth.token.admin == true;
    }

    // --- Admin-only content ---
    // For sensitive files not meant for public view
    match /private/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }

    // --- Temporary uploads for feedback submissions ---
    // These files are typically handled via signed URLs from a Cloud Function.
    // The rules ensure only the function can create them and they are not publicly accessible.
    match /uploads/tmp/{feedbackId}/{fileName} {
       // Allow create if the user is authenticated (via App Check from the client function)
       // and the file size is reasonable. A real-world app would have stricter
       // validation, likely via signed URLs.
       allow create: if request.auth != null && request.resource.size < 5 * 1024 * 1024;
    }
  }
}
